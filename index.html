<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=no">
  <title>ë°€í¬í‹° íŒ€ ìŠ¤ì¼€ì¤„ëŸ¬</title>
  <style>
    :root {
      --main-bg: #e3f2fd;
      --main-light: #bbdefb;
      --accent: #90caf9;
      --primary: #2196f3;
      --danger: #e57373;
      --holiday: #f8bbd0;
    }
    body {
      margin:0; background:var(--main-bg); color:#1a237e; font-family: 'Pretendard','Noto Sans KR',sans-serif;
      min-height:100vh;
    }
    header {
      background:var(--primary); color:#fff; padding:1.1rem 1rem;
      display:flex; align-items:center; justify-content:space-between;
      border-radius:0 0 1.2em 1.2em;
    }
    .logo { font-size:1.25em; font-weight:700;}
    .icon-btn { background:none;border:none; color:#fff; font-size:1.1em; cursor:pointer;}
    .container { max-width:460px; margin:0 auto; padding:0.6em 0.4em 1.5em 0.4em;}
    .filter { margin:0.8em 0 0.5em 0; display:flex; gap:0.4em; flex-wrap:wrap;}
    .filter button, .filter select {
      background:var(--main-light); border:none; border-radius:0.5em;
      padding:0.3em 1em; font-size:1em; color:#1976d2; cursor:pointer;
    }
    .searchbox { margin-bottom:0.9em; }
    .searchbox input { width:93%; padding:0.5em; border-radius:0.8em; border:1px solid #bbdefb; background:#fff;}
    .statbox {
      background:var(--main-light); border-radius:0.7em; padding:0.7em 1em;
      font-size:0.98em; margin:1em 0 0.3em 0;
    }
    .schedule-cards { display:flex; flex-direction:column; gap:0.9em;}
    .schedule-card {
      background:#fff; border-radius:1em; box-shadow:0 2px 10px 0 #e3f2fd;
      padding:1em 1em 0.6em 1em; display:flex; flex-direction:column; gap:0.15em;
      position:relative; border:2px solid transparent; transition:.2s;
    }
    .schedule-card.holiday { border-color:var(--holiday); background:#fff0f5;}
    .schedule-card .date { font-size:1.08em; font-weight:700;}
    .schedule-card .name { font-size:1em; font-weight:600;}
    .schedule-card .location { font-size:0.96em; color:#555;}
    .schedule-card .tags { display:flex; gap:0.5em;}
    .tag { font-size:0.82em; padding:0.12em 0.65em; border-radius:0.7em; margin-right:0.2em;}
    .tag.work { background:#b2dfdb;color:#00897b;}
    .tag.off { background:#ffe082;color:#fbc02d;}
    .tag.out { background:#c5cae9;color:#3949ab;}
    .controls { display:flex; align-items:center; gap:0.7em; margin-top:0.3em;}
    .controls input[type='number'] { width:3em; border:none; border-radius:0.5em; background:#e3f2fd; padding:0.2em 0.3em;}
    .controls label { font-size:0.92em; color:#444;}
    .memo { margin-top:0.25em; font-size:0.88em; color:#666; background:#f0f4c3; border-radius:0.4em; padding:0.2em 0.7em;}
    .mention { font-size:0.95em; color:var(--primary); margin-top:0.2em;}
    .actions { position:absolute; top:0.8em; right:1em;}
    .actions button { background:none; border:none; color:#7b8dbb; font-size:1.1em; cursor:pointer; margin-left:0.35em;}
    .admin-badge {display:inline-block;background:#1976d2;color:#fff;border-radius:1em;padding:0.19em 0.6em;font-size:0.88em;margin-left:0.6em;}
    .charts { margin-top:1.2em;}
    .chart-bar { height:1.1em; background:var(--main-light); border-radius:0.5em; margin:0.25em 0;}
    .chart-bar span { display:inline-block; height:100%; border-radius:0.5em; vertical-align:middle;}
    .toast {
      position:fixed;bottom:5%;left:50%;transform:translateX(-50%);
      background:#2196f3cc;color:#fff;padding:1em 1.3em;border-radius:2.2em;font-size:1.07em;z-index:1000;display:none;
    }
    #modal {display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:2000;background:#0002;}
    #modal-content {background:#fff;border-radius:1em;padding:1.2em 1.3em;max-width:330px;margin:10vh auto;}
    @media (max-width:500px) { .container {padding:0.1em;} }
  </style>
</head>
<body>
  <header>
    <span class="logo">ë°€í¬í‹° ìŠ¤ì¼€ì¤„ëŸ¬</span>
    <div>
      <button class="icon-btn" title="ë§ˆì´í˜ì´ì§€" onclick="toggleMyPage()">ğŸ‘¤</button>
      <button class="icon-btn" title="ê´€ë¦¬ìëª¨ë“œ" onclick="toggleAdminMode()">ğŸ”‘</button>
    </div>
  </header>
  <div class="container">
    <div class="statbox" id="statbox"></div>
    <div class="filter">
      <button onclick="setView('today')">ì˜¤ëŠ˜</button>
      <button onclick="setView('week')">ì£¼ê°„</button>
      <button onclick="setView('month')">ì›”ê°„</button>
      <select id="userFilter" onchange="applyFilter()">
        <option value="">ì „ì²´ íŒ€ì›</option>
      </select>
      <button onclick="downloadCSV()">CSV</button>
      <button onclick="savePDF()">PDF</button>
    </div>
    <div class="searchbox">
      <input type="text" id="search" placeholder="ì´ë¦„/ê·¼ë¬´ì§€/ë©”ëª¨ ê²€ìƒ‰..." oninput="applyFilter()">
    </div>
    <div class="schedule-cards" id="schedule-cards"></div>
    <div class="charts" id="charts"></div>
  </div>
  <div class="toast" id="toast"></div>
  <div id="modal">
    <div id="modal-content">
      <div id="modal-body"></div>
      <div style="text-align:right;margin-top:1em;">
        <button onclick="closeModal()" style="background:#2196f3;color:#fff;border:none;padding:0.5em 1.2em;border-radius:0.6em;">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
  <script>
    // ìƒ˜í”Œ ë°ì´í„°
    const initialData = [
      {
        "id":"20250502_1",
        "name":"í™ê¸¸ë™",
        "date":"2025-05-02",
        "location":"ê°•ë‚¨ì„¼í„°",
        "type":"ì¶œê·¼",
        "memo":"íŠ¹ê°• ì§„í–‰",
        "db":12,
        "attendance":true,
        "history":[],
        "lastEdit":"2025-05-01 21:22",
        "mention":"í™ê¸¸ë™ ë‹˜ì´ ìŠ¤ì¼€ì¤„ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤!"
      },
      {
        "id":"20250502_2",
        "name":"ê¹€ë¯¸ê²½",
        "date":"2025-05-02",
        "location":"ë¶„ë‹¹ì§€ì ",
        "type":"íœ´ë¬´",
        "memo":"ê°€ì¡± í–‰ì‚¬",
        "db":0,
        "attendance":false,
        "history":[],
        "lastEdit":"2025-05-01 18:04",
        "mention":"ê¹€ë¯¸ê²½ ë‹˜ì´ ìŠ¤ì¼€ì¤„ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤!"
      },
      {
        "id":"20250503_1",
        "name":"ì´ì˜í¬",
        "date":"2025-05-03",
        "location":"ì„œì´ˆì§€ì ",
        "type":"ì™¸ê·¼",
        "memo":"",
        "db":5,
        "attendance":true,
        "history":[],
        "lastEdit":"2025-05-02 11:01",
        "mention":"ì´ì˜í¬ ë‹˜ì´ ìŠ¤ì¼€ì¤„ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤!"
      }
    ];
    // ê³µíœ´ì¼(2025) ëª©ë¡
    const holidays2025 = {
      "2025-01-01":"ì‹ ì •",
      "2025-02-27":"ì„¤ì—°íœ´",
      "2025-02-28":"ì„¤ë‚ ",
      "2025-03-01":"ì‚¼ì¼ì ˆ",
      "2025-03-29":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ",
      "2025-05-01":"ê·¼ë¡œìì˜ë‚ ",
      "2025-05-05":"ì–´ë¦°ì´ë‚ ",
      "2025-05-06":"ëŒ€ì²´ê³µíœ´ì¼",
      "2025-06-06":"í˜„ì¶©ì¼",
      "2025-08-15":"ê´‘ë³µì ˆ",
      "2025-09-06":"ì¶”ì„ì—°íœ´",
      "2025-09-07":"ì¶”ì„",
      "2025-09-08":"ì¶”ì„ì—°íœ´",
      "2025-10-03":"ê°œì²œì ˆ",
      "2025-10-09":"í•œê¸€ë‚ ",
      "2025-12-25":"ì„±íƒ„ì ˆ"
    };
    const typeColor = { "ì¶œê·¼":"work", "íœ´ë¬´":"off", "ì™¸ê·¼":"out" };
    let data = [];
    let viewMode = 'today';
    let filterUser = '';
    let isMyPage = false;
    let isAdmin = false;
    let myName = localStorage.getItem('myName') || 'í™ê¸¸ë™';
    function loadData() {
      const saved = localStorage.getItem('scheduleData');
      if(saved) { try { data = JSON.parse(saved); } catch { data = initialData; } }
      else { data = initialData; saveData(); }
    }
    function saveData() {
      localStorage.setItem('scheduleData',JSON.stringify(data));
    }
    function updateUserFilter() {
      const users = [...new Set(data.map(d=>d.name))];
      const sel = document.getElementById('userFilter');
      sel.innerHTML = '<option value="">ì „ì²´ íŒ€ì›</option>' + users.map(u=>`<option>${u}</option>`).join('');
    }
    function getToday() {
      const d = new Date();
      return d.toISOString().slice(0,10);
    }
    function getWeekRange(date) {
      const d = new Date(date || getToday());
      const day = d.getDay()||7;
      const monday = new Date(d); monday.setDate(d.getDate()-day+1);
      const sunday = new Date(monday); sunday.setDate(monday.getDate()+6);
      return [monday.toISOString().slice(0,10), sunday.toISOString().slice(0,10)];
    }
    function getMonthRange(date) {
      const d = new Date(date||getToday());
      const first = new Date(d.getFullYear(),d.getMonth(),1);
      const last = new Date(d.getFullYear(),d.getMonth()+1,0);
      return [first.toISOString().slice(0,10), last.toISOString().slice(0,10)];
    }
    function applyFilter() {
      filterUser = document.getElementById('userFilter').value;
      render();
    }
    function setView(mode) {
      viewMode = mode;
      render();
    }
    function toggleMyPage() {
      isMyPage = !isMyPage;
      render();
    }
    function toggleAdminMode() {
      if(!isAdmin) {
        const pass = prompt("ê´€ë¦¬ì ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 1234):");
        if(pass==='1234') {
          isAdmin = true; showToast("ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”");
        } else { showToast("ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤."); return; }
      } else { isAdmin = false; showToast("ê´€ë¦¬ì ëª¨ë“œ í•´ì œ"); }
      render();
    }
    function filterData() {
      let list = [...data];
      let [from,to] = [null,null];
      if(viewMode==='today') { from=to=getToday(); }
      else if(viewMode==='week') [from,to] = getWeekRange();
      else if(viewMode==='month') [from,to] = getMonthRange();
      if(from&&to) list = list.filter(d=>d.date>=from && d.date<=to);
      if(filterUser) list = list.filter(d=>d.name===filterUser);
      if(isMyPage) list = list.filter(d=>d.name===myName);
      const q = document.getElementById('search').value.trim();
      if(q) {
        list = list.filter(d=>
          d.name.includes(q)||d.location.includes(q)||(d.memo&&d.memo.includes(q))
        );
      }
      list.sort((a,b)=>a.date.localeCompare(b.date)||a.name.localeCompare(b.name));
      return list;
    }
    function render() {
      updateUserFilter();
      const list = filterData();
      document.getElementById('statbox').innerHTML = makeStat(list);
      const box = document.getElementById('schedule-cards');
      box.innerHTML = '';
      for(const item of list) {
        const d = new Date(item.date);
        const weekday = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
        const holiday = holidays2025[item.date];
        const isSun = d.getDay()===0, isSat = d.getDay()===6;
        const card = document.createElement('div');
        card.className = 'schedule-card'+(holiday?' holiday':'');
        card.innerHTML = `
          <div class="date" style="color:${holiday?'#e53935':isSun?'#e57373':isSat?'#1976d2':'#1976d2'}">
            ${item.date} (${weekday})${holiday?' <span style="color:#e53935;font-weight:400">['+holiday+']</span>':''}
          </div>
          <div class="name">${item.name}${isMyPage&&item.name===myName?' <span class="admin-badge">ë‚´ ì¼ì •</span>':''}</div>
          <div class="location">ğŸ“ ${item.location}</div>
          <div class="tags"><span class="tag ${typeColor[item.type]||''}">${item.type}</span></div>
          <div class="controls">
            <label><input type="checkbox" ${item.attendance?'checked':''} onchange="toggleAttendance('${item.id}')"> ì¶œê²°</label>
            <label>DBìˆ˜ <input type="number" min="0" value="${item.db||0}" onchange="changeDB('${item.id}',this.value)"></label>
          </div>
          <div class="memo">ğŸ’¬ ${(item.memo||'')}</div>
          <div class="mention">${item.mention||''}</div>
          <div class="actions">
            <button title="ìˆ˜ì •ì´ë ¥" onclick="showHistory('${item.id}')">ğŸ•“</button>
            <button title="ê³¼ê±° ë³µêµ¬" onclick="showRestore('${item.id}')">â®Œ</button>
          </div>
        `;
        if(isAdmin) card.innerHTML += `<span class='admin-badge'>ê´€ë¦¬ì</span>`;
        box.appendChild(card);
      }
      renderCharts(list);
    }
    function toggleAttendance(id) {
      const idx = data.findIndex(d=>d.id===id);
      if(idx<0) return;
      const old = {...data[idx]};
      data[idx].attendance = !data[idx].attendance;
      data[idx].lastEdit = nowString();
      data[idx].mention = `${data[idx].name} ë‹˜ì´ ì¶œê²°ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤!`;
      pushHistory(idx,old);
      saveData();
      render();
      showToast(data[idx].mention);
    }
    function changeDB(id,val) {
      const idx = data.findIndex(d=>d.id===id);
      if(idx<0) return;
      const old = {...data[idx]};
      data[idx].db = Number(val)||0;
      data[idx].lastEdit = nowString();
      data[idx].mention = `${data[idx].name} ë‹˜ì´ DBìˆ˜ë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤!`;
      pushHistory(idx,old);
      saveData();
      render();
      showToast(data[idx].mention);
    }
    function showHistory(id) {
      const idx = data.findIndex(d=>d.id===id);
      if(idx<0) return;
      const h = data[idx].history||[];
      let html = `<h3>ìˆ˜ì • ì´ë ¥ (ìµœëŒ€ 5ë‹¨ê³„)</h3>`;
      if(h.length===0) html += '<p>ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
      else {
        html += '<ul style="font-size:0.97em;">'+
          h.map(hist=>
            `<li>${hist.lastEdit||''} : ì¶œê²°=${hist.attendance?'âœ”ï¸':'âŒ'} DB=${hist.db}, ë©”ëª¨=${hist.memo||''}</li>`
          ).join('')+'</ul>';
      }
      document.getElementById('modal-body').innerHTML = html;
      showModal();
    }
    function showRestore(id) {
      const idx = data.findIndex(d=>d.id===id);
      if(idx<0) return;
      const h = data[idx].history||[];
      if(h.length===0) { showToast("ë³µêµ¬ ê°€ëŠ¥í•œ ê³¼ê±° ë²„ì „ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
      let html = `<h3>ê³¼ê±° ë³µêµ¬ (ìµœëŒ€ 5ë‹¨ê³„)</h3><ul style="font-size:0.97em;">`;
      h.forEach((hist,i)=> {
        html += `<li>${hist.lastEdit||''} <button onclick="restoreHistory('${id}',${i})" style="background:#e3f2fd;color:#1976d2;border:none;border-radius:0.5em;padding:0.2em 0.7em;">ë³µêµ¬</button><br>
          ì¶œê²°=${hist.attendance?'âœ”ï¸':'âŒ'} DB=${hist.db}, ë©”ëª¨=${hist.memo||''}
        </li>`;
      });
      html += '</ul>';
      document.getElementById('modal-body').innerHTML = html;
      showModal();
    }
    function restoreHistory(id,idx) {
      const cardIdx = data.findIndex(d=>d.id===id);
      if(cardIdx<0) return;
      const hist = data[cardIdx].history[idx];
      if(!hist) return;
      data[cardIdx] = {...data[cardIdx], ...hist};
      data[cardIdx].lastEdit = nowString();
      data[cardIdx].mention = `ê´€ë¦¬ìê°€ ê³¼ê±° ë²„ì „(${hist.lastEdit})ìœ¼ë¡œ ë³µêµ¬í•˜ì˜€ìŠµë‹ˆë‹¤.`;
      saveData();
      closeModal(); render(); showToast("ë³µêµ¬ ì™„ë£Œ!");
    }
    function pushHistory(idx,oldData) {
      if(!data[idx].history) data[idx].history=[];
      data[idx].history.unshift(oldData);
      if(data[idx].history.length>5) data[idx].history=data[idx].history.slice(0,5);
    }
    function makeStat(list) {
      let total = list.length, works=0, offs=0, dbsum=0;
      for(const d of list) {
        if(d.type==='ì¶œê·¼'||d.type==='ì™¸ê·¼') works++;
        if(d.type==='íœ´ë¬´') offs++;
        dbsum += d.db||0;
      }
      return `ì¶œê·¼/ì™¸ê·¼: <b>${works}</b>ëª…, íœ´ë¬´: <b>${offs}</b>ëª…, DB: <b>${dbsum}</b>`;
    }
    function renderCharts(list) {
      const byType = {};
      for(const d of list) { byType[d.type]=byType[d.type]?byType[d.type]+1:1; }
      let html = `<h4>ê·¼ë¬´ìœ í˜•ë³„ í†µê³„</h4>`;
      for(const t in byType) {
        const w = Math.min(90, byType[t]*30);
        html += `<div>${t}: <span style="font-weight:700;color:#1976d2">${byType[t]}</span>
          <span class="chart-bar"><span style="width:${w}%;background:${t==='ì¶œê·¼'?'#90caf9':t==='íœ´ë¬´'?'#ffe082':'#c5cae9'}"></span></span>
        </div>`;
      }
      document.getElementById('charts').innerHTML = html;
    }
    function savePDF() {
      showToast("PDF ì €ì¥ì€ ë¸Œë¼ìš°ì € ì¸ì‡„/ì €ì¥(ê³µìœ )ë¡œ ì§€ì›í•©ë‹ˆë‹¤.");
      window.print();
    }
    function downloadCSV() {
      let csv = 'ë‚ ì§œ,ì´ë¦„,ê·¼ë¬´ì§€,ê·¼ë¬´ìœ í˜•,ì¶œê²°,DBìˆ˜,ë©”ëª¨\n';
      for(const d of filterData()) {
        csv += `${d.date},${d.name},${d.location},${d.type},${d.attendance?'ì¶œì„':'ê²°ì„'},${d.db},${(d.memo||'').replace(/,/g,';')}\n`;
      }
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'schedule.csv'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url),1000);
    }
    function showModal() { document.getElementById('modal').style.display='block'; }
    function closeModal() { document.getElementById('modal').style.display='none'; }
    function showToast(msg) {
      const t = document.getElementById('toast');
      t.innerText = msg; t.style.display='block';
      setTimeout(()=>{t.style.display='none';},1800);
    }
    function nowString() {
      const d = new Date();
      return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,0)}-${String(d.getDate()).padStart(2,0)} ${String(d.getHours()).padStart(2,0)}:${String(d.getMinutes()).padStart(2,0)}`;
    }
    function autoReport() {
      const d = new Date();
      if(d.getDay()===1 && d.getHours()>=9 && !localStorage.getItem('weeklyReport'+getToday())) {
        showToast("ì£¼ê°„ ë¦¬í¬íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (PDF/CSV ë‹¤ìš´)");
        localStorage.setItem('weeklyReport'+getToday(),true);
      }
    }
    function morningReminder() {
      const d = new Date();
      if(d.getHours()===8 && !localStorage.getItem('remind'+getToday())) {
        const todayList = data.filter(dd=>dd.date===getToday() && dd.type!=='íœ´ë¬´');
        if(todayList.some(dd=>dd.name===myName)) {
          showToast("ì˜¤ëŠ˜ ì¼ì •ì´ ìˆìŠµë‹ˆë‹¤! ìŠ¤ì¼€ì¤„ì„ í™•ì¸í•˜ì„¸ìš”.");
        }
        localStorage.setItem('remind'+getToday(),true);
      }
    }
    function main() {
      loadData();
      updateUserFilter();
      render();
      setInterval(autoReport, 1000*60*60);
      setInterval(morningReminder, 1000*60*15);
    }
    main();
  </script>
</body>
</html>
