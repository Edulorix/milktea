<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=no">
  <title>밀크티 팀 스케줄 뷰어</title>
  <style>
    :root {
      --main-bg: #e3f2fd;
      --main-light: #bbdefb;
      --card-bg: #fff;
      --primary: #2196f3;
      --accent: #90caf9;
      --work: #b2dfdb;
      --work2:#c5cae9;
      --off: #ffe082;
      --danger: #e57373;
      --holiday: #f8bbd0;
      --border-radius: 1.2em;
    }
    body {
      margin:0; background:var(--main-bg); color:#1a237e; font-family: 'Pretendard','Noto Sans KR',sans-serif;
      min-height:100vh;
    }
    header {
      background:var(--primary); color:#fff; padding:1.2rem 1rem 0.7rem 1rem;
      display:flex; align-items:center; justify-content:space-between;
      border-radius:0 0 var(--border-radius) var(--border-radius);
    }
    .logo { font-size:1.22em; font-weight:700;}
    .icon-btn { background:none;border:none; color:#fff; font-size:1.13em; cursor:pointer; }
    .container { max-width:500px; margin:0 auto; padding:0.8em 0.5em 1.5em 0.5em;}
    .tabs { display:flex; gap:0.3em; margin:1.1em 0 0.6em 0;}
    .tabs button {
      flex: 1 1 0; background:var(--main-light); border:none; border-radius:0.7em;
      padding:0.49em 0.1em; font-size:1em; color:#1976d2; font-weight:600; cursor:pointer;
    }
    .tabs .active { background:var(--primary); color:#fff;}
    .filter { margin-bottom:0.7em; display:flex; gap:0.4em; flex-wrap:wrap;}
    .filter input[type="text"] { flex:2 1 0; padding:0.52em; border-radius:0.9em; border:1px solid #bbdefb; background:#fff;}
    .filter select { border-radius:0.6em; border:1px solid #bbdefb; background:#fff; color:#1976d2; padding:0.35em 0.7em;}
    .statbox { background:var(--main-light); border-radius:0.85em; padding:0.8em 1.2em; font-size:1.01em; margin:1.1em 0 0.35em 0;}
    .schedule-cards { display:flex; flex-direction:column; gap:0.95em;}
    .date-label {
      font-weight:700; font-size:1.04em; margin:0.55em 0 0.3em 0; letter-spacing:0.02em;
      color:var(--primary);
    }
    .schedule-card {
      background:var(--card-bg); border-radius:var(--border-radius); box-shadow:0 2px 10px 0 #e3f2fd;
      padding:1.1em 1em 0.8em 1em; display:flex; flex-direction:column; gap:0.13em;
      border:2.5px solid transparent; transition:.2s;
      position:relative; min-width:0;
    }
    .schedule-card.off { border-color:var(--off); background:#fffbe6;}
    .schedule-card.holiday { border-color:var(--holiday); background:#fff0f5;}
    .schedule-card .top { display:flex; justify-content:space-between; align-items:center;}
    .schedule-card .name { font-size:1.08em; font-weight:600;}
    .schedule-card .memo {margin-top:0.22em; font-size:0.92em; color:#546e7a; background:#f0f4c3; border-radius:0.5em; padding:0.13em 0.7em 0.12em 0.7em;}
    .schedule-card .tags { display:flex; gap:0.5em; margin:0.18em 0;}
    .schedule-card .tag { font-size:0.84em; padding:0.09em 0.7em; border-radius:0.7em; margin-right:0.21em;}
    .schedule-card .tag.work { background:var(--work); color:#00897b;}
    .schedule-card .tag.work2 { background:var(--work2); color:#3949ab;}
    .schedule-card .tag.off { background:var(--off); color:#fbc02d;}
    .schedule-card .location { font-size:0.97em; color:#1565c0; font-weight:500; margin-bottom:0.09em;}
    .schedule-card .edit-btn, .schedule-card .del-btn {
      border:none; background:none; font-size:1.2em; color:#1976d2; cursor:pointer; margin-left:0.7em;}
    .schedule-card .del-btn { color:#d32f2f;}
    .place-group { border-left:4px solid var(--accent); margin:0.2em 0 0.2em 0.3em; padding-left:0.7em;}
    .place-group.sameplace { border-color:#90caf9; background:#e3f2fd4a;}
    .place-group:not(.sameplace) { border-color:#b2dfdb;}
    .holiday-label { color:#e53935; font-weight:600; font-size:0.98em; margin-left:0.45em;}
    .charts { margin:1.3em 0 0 0;}
    .chart-bar { height:1.13em; background:var(--main-light); border-radius:0.6em; margin:0.23em 0;}
    .chart-bar span { display:inline-block; height:100%; border-radius:0.6em; vertical-align:middle;}
    #modal {display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:2000;background:#0002;}
    #modal-content {background:#fff;border-radius:1.2em;padding:1.4em 1.3em;max-width:340px;margin:11vh auto;}
    .modal-head {font-weight:700;font-size:1.08em;margin-bottom:0.7em;}
    .modal-row {margin:0.5em 0;}
    .modal-row input, .modal-row textarea { width:92%; padding:0.36em 0.7em; border-radius:0.7em; border:1px solid #bbdefb; margin-top:0.12em;}
    .modal-row textarea { min-height:2.1em; resize:vertical;}
    .modal-btn { background:var(--primary);color:#fff;border:none;padding:0.48em 1.6em;border-radius:0.7em;font-size:1em;}
    .modal-btn.cancel {background:#b0bec5;}
    @media (max-width:500px) { .container {padding:0.07em;} }
  </style>
</head>
<body>
  <header>
    <span class="logo">밀크티 스케줄 뷰어</span>
    <button class="icon-btn" onclick="showEditModal()" title="일정추가">➕</button>
  </header>
  <div class="container">
    <div class="statbox" id="statbox"></div>
    <div class="tabs">
      <button id="tab-week" onclick="setView('week')">주간</button>
      <button id="tab-month" onclick="setView('month')">월간</button>
      <button id="tab-summary" onclick="setView('summary')">요약</button>
    </div>
    <div class="filter">
      <input type="text" id="search" placeholder="이름, 근무지, 메모 검색" oninput="render()">
      <select id="dayFilter" onchange="render()">
        <option value="">전체요일</option>
        <option value="0">일요일</option>
        <option value="1">월요일</option>
        <option value="2">화요일</option>
        <option value="3">수요일</option>
        <option value="4">목요일</option>
        <option value="5">금요일</option>
        <option value="6">토요일</option>
      </select>
    </div>
    <div class="schedule-cards" id="schedule-cards"></div>
    <div class="charts" id="charts"></div>
  </div>
  <div id="modal">
    <div id="modal-content"></div>
  </div>
  <script>
    // ---------- 공휴일 데이터 2025 ----------
    const holidays2025 = {
      "2025-01-01":"신정", "2025-02-27":"설연휴", "2025-02-28":"설날",
      "2025-03-01":"삼일절", "2025-03-29":"부처님오신날", "2025-05-01":"근로자의날",
      "2025-05-05":"어린이날", "2025-05-06":"대체공휴일", "2025-06-06":"현충일",
      "2025-08-15":"광복절", "2025-09-06":"추석연휴", "2025-09-07":"추석",
      "2025-09-08":"추석연휴", "2025-10-03":"개천절", "2025-10-09":"한글날", "2025-12-25":"성탄절"
    };
    // ---------- 샘플 데이터 ----------
    let data = JSON.parse(localStorage.getItem('scheduleData') || '[]');
    if(data.length===0) data = [
      { id:1, name:"김민지", date:"2025-05-01", places:["강남센터","분당지점"], memo:"특강", off:false },
      { id:2, name:"김미경", date:"2025-05-01", places:["휴무"], memo:"가족행사", off:true },
      { id:3, name:"홍길동", date:"2025-05-01", places:["분당지점"], memo:"", off:false },
      { id:4, name:"김민지", date:"2025-05-02", places:["강남센터"], memo:"", off:false }
    ];
    // ---------- 상태 ----------
    let viewMode = 'week'; // week, month, summary
    function setView(mode) {
      viewMode = mode;
      document.getElementById('tab-week').classList.toggle('active',mode==='week');
      document.getElementById('tab-month').classList.toggle('active',mode==='month');
      document.getElementById('tab-summary').classList.toggle('active',mode==='summary');
      render();
    }
    // ---------- 날짜 유틸 ----------
    function getToday() { const d = new Date(); return d.toISOString().slice(0,10);}
    function getWeekRange(date) {
      const d = new Date(date||getToday());
      const day = d.getDay()||7, monday = new Date(d); monday.setDate(d.getDate()-day+1);
      const sunday = new Date(monday); sunday.setDate(monday.getDate()+6);
      return [monday.toISOString().slice(0,10), sunday.toISOString().slice(0,10)];
    }
    function getMonthRange(date) {
      const d = new Date(date||getToday());
      const first = new Date(d.getFullYear(),d.getMonth(),1);
      const last = new Date(d.getFullYear(),d.getMonth()+1,0);
      return [first.toISOString().slice(0,10), last.toISOString().slice(0,10)];
    }
    // ---------- 데이터 필터 ----------
    function filterData() {
      let list = data.slice();
      // 주/월 범위
      let from=null,to=null;
      if(viewMode==='week') [from,to]=getWeekRange();
      else if(viewMode==='month') [from,to]=getMonthRange();
      if(from&&to) list = list.filter(d=>d.date>=from && d.date<=to);
      // 검색
      const q = document.getElementById('search').value.trim();
      if(q) list = list.filter(d=>
        d.name.includes(q) || d.places.join(',').includes(q) || (d.memo && d.memo.includes(q))
      );
      // 요일 필터
      const weekval=document.getElementById('dayFilter').value;
      if(weekval!=='') list = list.filter(d=>(new Date(d.date).getDay()+'')===weekval);
      // 정렬: 날짜, 이름
      list.sort((a,b)=>a.date.localeCompare(b.date)||a.name.localeCompare(b.name));
      return list;
    }
    // ---------- 렌더링 ----------
    function render() {
      renderStats();
      if(viewMode==='summary') renderSummary(); else renderCards();
    }
    function renderCards() {
      const list = filterData();
      const box = document.getElementById('schedule-cards');
      box.innerHTML = '';
      let lastDate = '';
      // 근무지별 그룹핑을 위해 (같은 근무지 2명 이상 표시)
      const placesByDatePlace = {};
      for(const row of list) {
        row.places.forEach(place=>{
          const key = row.date+'__'+place;
          if(!placesByDatePlace[key]) placesByDatePlace[key]=[];
          placesByDatePlace[key].push(row.name);
        });
      }
      for(const row of list) {
        if(row.date!==lastDate) {
          const d=new Date(row.date), wd=['일','월','화','수','목','금','토'][d.getDay()];
          const holiday=holidays2025[row.date];
          box.innerHTML += `<div class="date-label">
            ${row.date} (${wd})${holiday?`<span class="holiday-label">[${holiday}]</span>`:""}
          </div>`;
          lastDate=row.date;
        }
        // 여러 근무지 줄(1인2장소)
        row.places.forEach((place,idx)=>{
          const groupKey=row.date+'__'+place;
          const samePlace=placesByDatePlace[groupKey]&&placesByDatePlace[groupKey].length>1;
          const card = document.createElement('div');
          card.className = 'schedule-card'+(row.off?' off':'')+(holidays2025[row.date]?' holiday':'');
          card.innerHTML = `
            <div class="top">
              <div class="name">${row.name}</div>
              ${row.off?'<span class="tag off">휴무</span>':''}
              ${!row.off?`<span class="tag ${samePlace?'work2':'work'}">${samePlace?'중복근무지':'근무'}</span>`:''}
              <button class="edit-btn" onclick="showEditModal(${row.id},${idx})" title="수정">✏️</button>
              <button class="del-btn" onclick="delEntry(${row.id},${idx})" title="삭제">🗑️</button>
            </div>
            <div class="place-group${samePlace?' sameplace':''}"><span class="location">${place}</span></div>
            ${row.memo&&idx===0?`<div class="memo">${row.memo}</div>`:""}
          `;
          box.appendChild(card);
        });
      }
      document.getElementById('charts').innerHTML = '';
    }
    // 요약
    function renderSummary() {
      // 선생님별로 근무지 방문 누적
      const teacherSum = {};
      data.forEach(row=>{
        if(!teacherSum[row.name]) teacherSum[row.name]={};
        row.places.forEach(place=>{
          if(place==='휴무') return;
          teacherSum[row.name][place]=(teacherSum[row.name][place]||0)+1;
        });
      });
      let html = `<div class="date-label">요약 보기</div>`;
      for(const name in teacherSum) {
        html += `<div class="schedule-card"><div class="name">${name}</div>`;
        for(const place in teacherSum[name]) {
          html += `<div class="place-group"><span class="location">${place}</span> <span style="color:#1976d2;font-weight:700;">${teacherSum[name][place]}회</span></div>`;
        }
        html += `</div>`;
      }
      document.getElementById('schedule-cards').innerHTML = html;
      document.getElementById('charts').innerHTML = '';
    }
    // ---------- 통계 ----------
    function renderStats() {
      // 월별 휴무일수 자동 집계
      const list = filterData();
      const offByName = {};
      list.forEach(d=>{
        if(!offByName[d.name]) offByName[d.name]=0;
        if(d.off) offByName[d.name]++;
      });
      let stat = Object.entries(offByName).map(([name,cnt])=>`${name}: 휴무 ${cnt}일`).join(" / ");
      if(stat) stat="월별 휴무 집계 - "+stat;
      document.getElementById('statbox').innerHTML = stat||"";
    }
    // ---------- 일정 추가/수정/삭제 ----------
    function showEditModal(id=null,placeIdx=null) {
      let entry={id:"",name:"",date:getToday(),places:[""],memo:"",off:false}, isEdit=false, editPlaceIdx=0;
      if(id!=null) {
        let found=data.find(d=>d.id===id);
        if(found) {
          entry={...found}; isEdit=true;
          // 여러 근무지 중 개별 수정
          if(typeof placeIdx==="number") {
            editPlaceIdx=placeIdx;
            entry.places=[found.places[placeIdx]];
          }
        }
      }
      let html=`
      <div class="modal-head">${isEdit?"일정 수정":"일정 추가"}</div>
      <div class="modal-row">이름<br><input id="modal-name" value="${entry.name||""}"></div>
      <div class="modal-row">날짜<br><input id="modal-date" type="date" value="${entry.date||getToday()}"></div>
      <div class="modal-row">근무지(여러 곳은 ,로 구분)<br>
        <input id="modal-place" value="${entry.places.join(',')}">
      </div>
      <div class="modal-row"><label>
        <input id="modal-off" type="checkbox" ${entry.off?"checked":""}> 휴무(근무지 무시)
      </label></div>
      <div class="modal-row">메모<br><textarea id="modal-memo">${entry.memo||""}</textarea></div>
      <div style="text-align:right;margin-top:1.2em;">
        <button class="modal-btn" onclick="saveModal(${isEdit?entry.id:"null"},${isEdit?editPlaceIdx:"null"})">${isEdit?"수정":"추가"}</button>
        <button class="modal-btn cancel" onclick="closeModal()">취소</button>
      </div>
      `;
      document.getElementById('modal-content').innerHTML=html;
      document.getElementById('modal').style.display='block';
    }
    function closeModal(){document.getElementById('modal').style.display='none';}
    function saveModal(id,placeIdx){
      let name=document.getElementById('modal-name').value.trim();
      let date=document.getElementById('modal-date').value;
      let place=document.getElementById('modal-place').value.split(',').map(s=>s.trim()).filter(s=>s);
      let off=document.getElementById('modal-off').checked;
      let memo=document.getElementById('modal-memo').value.trim();
      if(!name||!date||(place.length===0&&!off)){
        alert("이름, 날짜, 근무지를 입력하세요");return;
      }
      if(id==null){
        let nid=Date.now()+Math.floor(Math.random()*1000);
        data.push({id:nid,name,date,places:off?["휴무"]:place,memo,off});
      }else{
        let found=data.find(d=>d.id===id);
        if(found){
          // 여러 근무지 중 하나만 수정
          if(typeof placeIdx==="number"){
            found.places[placeIdx]=off?"휴무":place[0];
            found.off=off;
            found.memo=memo;
          }else{
            found.name=name; found.date=date; found.places=off?["휴무"]:place; found.off=off; found.memo=memo;
          }
        }
      }
      saveData();
      closeModal();
      render();
    }
    function delEntry(id,placeIdx){
      if(!confirm("정말 삭제하시겠습니까?")) return;
      let found=data.find(d=>d.id===id);
      if(found){
        if(typeof placeIdx==="number" && found.places.length>1){
          found.places.splice(placeIdx,1);
        }else{
          data=data.filter(d=>d.id!==id);
        }
        saveData();
        render();
      }
    }
    function saveData(){
      localStorage.setItem('scheduleData',JSON.stringify(data));
    }
    // ---------- 앱 시작 ----------
    setView('week');
    </script>
</body>
</html>
