<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=no">
  <title>ë°€í¬í‹° íŒ€ ìŠ¤ì¼€ì¤„ ë·°ì–´</title>
  <style>
    :root {
      --main-bg: #e3f2fd;
      --main-light: #bbdefb;
      --card-bg: #fff;
      --primary: #2196f3;
      --accent: #90caf9;
      --work: #b2dfdb;
      --work2:#c5cae9;
      --off: #ffe082;
      --danger: #e57373;
      --holiday: #f8bbd0;
      --border-radius: 1.2em;
    }
    body {
      margin:0; background:var(--main-bg); color:#1a237e; font-family: 'Pretendard','Noto Sans KR',sans-serif;
      min-height:100vh;
    }
    header {
      background:var(--primary); color:#fff; padding:1.2rem 1rem 0.7rem 1rem;
      display:flex; align-items:center; justify-content:space-between;
      border-radius:0 0 var(--border-radius) var(--border-radius);
    }
    .logo { font-size:1.22em; font-weight:700;}
    .icon-btn { background:none;border:none; color:#fff; font-size:1.13em; cursor:pointer; }
    .container { max-width:500px; margin:0 auto; padding:0.8em 0.5em 1.5em 0.5em;}
    .tabs { display:flex; gap:0.3em; margin:1.1em 0 0.6em 0;}
    .tabs button {
      flex: 1 1 0; background:var(--main-light); border:none; border-radius:0.7em;
      padding:0.49em 0.1em; font-size:1em; color:#1976d2; font-weight:600; cursor:pointer;
    }
    .tabs .active { background:var(--primary); color:#fff;}
    .filter { margin-bottom:0.7em; display:flex; gap:0.4em; flex-wrap:wrap;}
    .filter input[type="text"] { flex:2 1 0; padding:0.52em; border-radius:0.9em; border:1px solid #bbdefb; background:#fff;}
    .filter select { border-radius:0.6em; border:1px solid #bbdefb; background:#fff; color:#1976d2; padding:0.35em 0.7em;}
    .statbox { background:var(--main-light); border-radius:0.85em; padding:0.8em 1.2em; font-size:1.01em; margin:1.1em 0 0.35em 0;}
    .schedule-cards { display:flex; flex-direction:column; gap:0.95em;}
    .date-label {
      font-weight:700; font-size:1.04em; margin:0.55em 0 0.3em 0; letter-spacing:0.02em;
      color:var(--primary);
    }
    .schedule-card {
      background:var(--card-bg); border-radius:var(--border-radius); box-shadow:0 2px 10px 0 #e3f2fd;
      padding:1.1em 1em 0.8em 1em; display:flex; flex-direction:column; gap:0.13em;
      border:2.5px solid transparent; transition:.2s;
      position:relative; min-width:0;
    }
    .schedule-card.off { border-color:var(--off); background:#fffbe6;}
    .schedule-card.holiday { border-color:var(--holiday); background:#fff0f5;}
    .schedule-card .top { display:flex; justify-content:space-between; align-items:center;}
    .schedule-card .name { font-size:1.08em; font-weight:600;}
    .schedule-card .memo {margin-top:0.22em; font-size:0.92em; color:#546e7a; background:#f0f4c3; border-radius:0.5em; padding:0.13em 0.7em 0.12em 0.7em;}
    .schedule-card .tags { display:flex; gap:0.5em; margin:0.18em 0;}
    .schedule-card .tag { font-size:0.84em; padding:0.09em 0.7em; border-radius:0.7em; margin-right:0.21em;}
    .schedule-card .tag.work { background:var(--work); color:#00897b;}
    .schedule-card .tag.work2 { background:var(--work2); color:#3949ab;}
    .schedule-card .tag.off { background:var(--off); color:#fbc02d;}
    .schedule-card .location { font-size:0.97em; color:#1565c0; font-weight:500; margin-bottom:0.09em;}
    .schedule-card .edit-btn, .schedule-card .del-btn {
      border:none; background:none; font-size:1.2em; color:#1976d2; cursor:pointer; margin-left:0.7em;}
    .schedule-card .del-btn { color:#d32f2f;}
    .place-group { border-left:4px solid var(--accent); margin:0.2em 0 0.2em 0.3em; padding-left:0.7em;}
    .place-group.sameplace { border-color:#90caf9; background:#e3f2fd4a;}
    .place-group:not(.sameplace) { border-color:#b2dfdb;}
    .holiday-label { color:#e53935; font-weight:600; font-size:0.98em; margin-left:0.45em;}
    .charts { margin:1.3em 0 0 0;}
    .chart-bar { height:1.13em; background:var(--main-light); border-radius:0.6em; margin:0.23em 0;}
    .chart-bar span { display:inline-block; height:100%; border-radius:0.6em; vertical-align:middle;}
    #modal {display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:2000;background:#0002;}
    #modal-content {background:#fff;border-radius:1.2em;padding:1.4em 1.3em;max-width:340px;margin:11vh auto;}
    .modal-head {font-weight:700;font-size:1.08em;margin-bottom:0.7em;}
    .modal-row {margin:0.5em 0;}
    .modal-row input, .modal-row textarea { width:92%; padding:0.36em 0.7em; border-radius:0.7em; border:1px solid #bbdefb; margin-top:0.12em;}
    .modal-row textarea { min-height:2.1em; resize:vertical;}
    .modal-btn { background:var(--primary);color:#fff;border:none;padding:0.48em 1.6em;border-radius:0.7em;font-size:1em;}
    .modal-btn.cancel {background:#b0bec5;}
    @media (max-width:500px) { .container {padding:0.07em;} }
  </style>
</head>
<body>
  <header>
    <span class="logo">ë°€í¬í‹° ìŠ¤ì¼€ì¤„ ë·°ì–´</span>
    <button class="icon-btn" onclick="showEditModal()" title="ì¼ì •ì¶”ê°€">â•</button>
  </header>
  <div class="container">
    <div class="statbox" id="statbox"></div>
    <div class="tabs">
      <button id="tab-week" onclick="setView('week')">ì£¼ê°„</button>
      <button id="tab-month" onclick="setView('month')">ì›”ê°„</button>
      <button id="tab-summary" onclick="setView('summary')">ìš”ì•½</button>
    </div>
    <div class="filter">
      <input type="text" id="search" placeholder="ì´ë¦„, ê·¼ë¬´ì§€, ë©”ëª¨ ê²€ìƒ‰" oninput="render()">
      <select id="dayFilter" onchange="render()">
        <option value="">ì „ì²´ìš”ì¼</option>
        <option value="0">ì¼ìš”ì¼</option>
        <option value="1">ì›”ìš”ì¼</option>
        <option value="2">í™”ìš”ì¼</option>
        <option value="3">ìˆ˜ìš”ì¼</option>
        <option value="4">ëª©ìš”ì¼</option>
        <option value="5">ê¸ˆìš”ì¼</option>
        <option value="6">í† ìš”ì¼</option>
      </select>
    </div>
    <div class="schedule-cards" id="schedule-cards"></div>
    <div class="charts" id="charts"></div>
  </div>
  <div id="modal">
    <div id="modal-content"></div>
  </div>
  <script>
    // ---------- ê³µíœ´ì¼ ë°ì´í„° 2025 ----------
    const holidays2025 = {
      "2025-01-01":"ì‹ ì •", "2025-02-27":"ì„¤ì—°íœ´", "2025-02-28":"ì„¤ë‚ ",
      "2025-03-01":"ì‚¼ì¼ì ˆ", "2025-03-29":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ", "2025-05-01":"ê·¼ë¡œìì˜ë‚ ",
      "2025-05-05":"ì–´ë¦°ì´ë‚ ", "2025-05-06":"ëŒ€ì²´ê³µíœ´ì¼", "2025-06-06":"í˜„ì¶©ì¼",
      "2025-08-15":"ê´‘ë³µì ˆ", "2025-09-06":"ì¶”ì„ì—°íœ´", "2025-09-07":"ì¶”ì„",
      "2025-09-08":"ì¶”ì„ì—°íœ´", "2025-10-03":"ê°œì²œì ˆ", "2025-10-09":"í•œê¸€ë‚ ", "2025-12-25":"ì„±íƒ„ì ˆ"
    };
    // ---------- ìƒ˜í”Œ ë°ì´í„° ----------
    let data = JSON.parse(localStorage.getItem('scheduleData') || '[]');
    if(data.length===0) data = [
      { id:1, name:"ê¹€ë¯¼ì§€", date:"2025-05-01", places:["ê°•ë‚¨ì„¼í„°","ë¶„ë‹¹ì§€ì "], memo:"íŠ¹ê°•", off:false },
      { id:2, name:"ê¹€ë¯¸ê²½", date:"2025-05-01", places:["íœ´ë¬´"], memo:"ê°€ì¡±í–‰ì‚¬", off:true },
      { id:3, name:"í™ê¸¸ë™", date:"2025-05-01", places:["ë¶„ë‹¹ì§€ì "], memo:"", off:false },
      { id:4, name:"ê¹€ë¯¼ì§€", date:"2025-05-02", places:["ê°•ë‚¨ì„¼í„°"], memo:"", off:false }
    ];
    // ---------- ìƒíƒœ ----------
    let viewMode = 'week'; // week, month, summary
    function setView(mode) {
      viewMode = mode;
      document.getElementById('tab-week').classList.toggle('active',mode==='week');
      document.getElementById('tab-month').classList.toggle('active',mode==='month');
      document.getElementById('tab-summary').classList.toggle('active',mode==='summary');
      render();
    }
    // ---------- ë‚ ì§œ ìœ í‹¸ ----------
    function getToday() { const d = new Date(); return d.toISOString().slice(0,10);}
    function getWeekRange(date) {
      const d = new Date(date||getToday());
      const day = d.getDay()||7, monday = new Date(d); monday.setDate(d.getDate()-day+1);
      const sunday = new Date(monday); sunday.setDate(monday.getDate()+6);
      return [monday.toISOString().slice(0,10), sunday.toISOString().slice(0,10)];
    }
    function getMonthRange(date) {
      const d = new Date(date||getToday());
      const first = new Date(d.getFullYear(),d.getMonth(),1);
      const last = new Date(d.getFullYear(),d.getMonth()+1,0);
      return [first.toISOString().slice(0,10), last.toISOString().slice(0,10)];
    }
    // ---------- ë°ì´í„° í•„í„° ----------
    function filterData() {
      let list = data.slice();
      // ì£¼/ì›” ë²”ìœ„
      let from=null,to=null;
      if(viewMode==='week') [from,to]=getWeekRange();
      else if(viewMode==='month') [from,to]=getMonthRange();
      if(from&&to) list = list.filter(d=>d.date>=from && d.date<=to);
      // ê²€ìƒ‰
      const q = document.getElementById('search').value.trim();
      if(q) list = list.filter(d=>
        d.name.includes(q) || d.places.join(',').includes(q) || (d.memo && d.memo.includes(q))
      );
      // ìš”ì¼ í•„í„°
      const weekval=document.getElementById('dayFilter').value;
      if(weekval!=='') list = list.filter(d=>(new Date(d.date).getDay()+'')===weekval);
      // ì •ë ¬: ë‚ ì§œ, ì´ë¦„
      list.sort((a,b)=>a.date.localeCompare(b.date)||a.name.localeCompare(b.name));
      return list;
    }
    // ---------- ë Œë”ë§ ----------
    function render() {
      renderStats();
      if(viewMode==='summary') renderSummary(); else renderCards();
    }
    function renderCards() {
      const list = filterData();
      const box = document.getElementById('schedule-cards');
      box.innerHTML = '';
      let lastDate = '';
      // ê·¼ë¬´ì§€ë³„ ê·¸ë£¹í•‘ì„ ìœ„í•´ (ê°™ì€ ê·¼ë¬´ì§€ 2ëª… ì´ìƒ í‘œì‹œ)
      const placesByDatePlace = {};
      for(const row of list) {
        row.places.forEach(place=>{
          const key = row.date+'__'+place;
          if(!placesByDatePlace[key]) placesByDatePlace[key]=[];
          placesByDatePlace[key].push(row.name);
        });
      }
      for(const row of list) {
        if(row.date!==lastDate) {
          const d=new Date(row.date), wd=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
          const holiday=holidays2025[row.date];
          box.innerHTML += `<div class="date-label">
            ${row.date} (${wd})${holiday?`<span class="holiday-label">[${holiday}]</span>`:""}
          </div>`;
          lastDate=row.date;
        }
        // ì—¬ëŸ¬ ê·¼ë¬´ì§€ ì¤„(1ì¸2ì¥ì†Œ)
        row.places.forEach((place,idx)=>{
          const groupKey=row.date+'__'+place;
          const samePlace=placesByDatePlace[groupKey]&&placesByDatePlace[groupKey].length>1;
          const card = document.createElement('div');
          card.className = 'schedule-card'+(row.off?' off':'')+(holidays2025[row.date]?' holiday':'');
          card.innerHTML = `
            <div class="top">
              <div class="name">${row.name}</div>
              ${row.off?'<span class="tag off">íœ´ë¬´</span>':''}
              ${!row.off?`<span class="tag ${samePlace?'work2':'work'}">${samePlace?'ì¤‘ë³µê·¼ë¬´ì§€':'ê·¼ë¬´'}</span>`:''}
              <button class="edit-btn" onclick="showEditModal(${row.id},${idx})" title="ìˆ˜ì •">âœï¸</button>
              <button class="del-btn" onclick="delEntry(${row.id},${idx})" title="ì‚­ì œ">ğŸ—‘ï¸</button>
            </div>
            <div class="place-group${samePlace?' sameplace':''}"><span class="location">${place}</span></div>
            ${row.memo&&idx===0?`<div class="memo">${row.memo}</div>`:""}
          `;
          box.appendChild(card);
        });
      }
      document.getElementById('charts').innerHTML = '';
    }
    // ìš”ì•½
    function renderSummary() {
      // ì„ ìƒë‹˜ë³„ë¡œ ê·¼ë¬´ì§€ ë°©ë¬¸ ëˆ„ì 
      const teacherSum = {};
      data.forEach(row=>{
        if(!teacherSum[row.name]) teacherSum[row.name]={};
        row.places.forEach(place=>{
          if(place==='íœ´ë¬´') return;
          teacherSum[row.name][place]=(teacherSum[row.name][place]||0)+1;
        });
      });
      let html = `<div class="date-label">ìš”ì•½ ë³´ê¸°</div>`;
      for(const name in teacherSum) {
        html += `<div class="schedule-card"><div class="name">${name}</div>`;
        for(const place in teacherSum[name]) {
          html += `<div class="place-group"><span class="location">${place}</span> <span style="color:#1976d2;font-weight:700;">${teacherSum[name][place]}íšŒ</span></div>`;
        }
        html += `</div>`;
      }
      document.getElementById('schedule-cards').innerHTML = html;
      document.getElementById('charts').innerHTML = '';
    }
    // ---------- í†µê³„ ----------
    function renderStats() {
      // ì›”ë³„ íœ´ë¬´ì¼ìˆ˜ ìë™ ì§‘ê³„
      const list = filterData();
      const offByName = {};
      list.forEach(d=>{
        if(!offByName[d.name]) offByName[d.name]=0;
        if(d.off) offByName[d.name]++;
      });
      let stat = Object.entries(offByName).map(([name,cnt])=>`${name}: íœ´ë¬´ ${cnt}ì¼`).join(" / ");
      if(stat) stat="ì›”ë³„ íœ´ë¬´ ì§‘ê³„ - "+stat;
      document.getElementById('statbox').innerHTML = stat||"";
    }
    // ---------- ì¼ì • ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ ----------
    function showEditModal(id=null,placeIdx=null) {
      let entry={id:"",name:"",date:getToday(),places:[""],memo:"",off:false}, isEdit=false, editPlaceIdx=0;
      if(id!=null) {
        let found=data.find(d=>d.id===id);
        if(found) {
          entry={...found}; isEdit=true;
          // ì—¬ëŸ¬ ê·¼ë¬´ì§€ ì¤‘ ê°œë³„ ìˆ˜ì •
          if(typeof placeIdx==="number") {
            editPlaceIdx=placeIdx;
            entry.places=[found.places[placeIdx]];
          }
        }
      }
      let html=`
      <div class="modal-head">${isEdit?"ì¼ì • ìˆ˜ì •":"ì¼ì • ì¶”ê°€"}</div>
      <div class="modal-row">ì´ë¦„<br><input id="modal-name" value="${entry.name||""}"></div>
      <div class="modal-row">ë‚ ì§œ<br><input id="modal-date" type="date" value="${entry.date||getToday()}"></div>
      <div class="modal-row">ê·¼ë¬´ì§€(ì—¬ëŸ¬ ê³³ì€ ,ë¡œ êµ¬ë¶„)<br>
        <input id="modal-place" value="${entry.places.join(',')}">
      </div>
      <div class="modal-row"><label>
        <input id="modal-off" type="checkbox" ${entry.off?"checked":""}> íœ´ë¬´(ê·¼ë¬´ì§€ ë¬´ì‹œ)
      </label></div>
      <div class="modal-row">ë©”ëª¨<br><textarea id="modal-memo">${entry.memo||""}</textarea></div>
      <div style="text-align:right;margin-top:1.2em;">
        <button class="modal-btn" onclick="saveModal(${isEdit?entry.id:"null"},${isEdit?editPlaceIdx:"null"})">${isEdit?"ìˆ˜ì •":"ì¶”ê°€"}</button>
        <button class="modal-btn cancel" onclick="closeModal()">ì·¨ì†Œ</button>
      </div>
      `;
      document.getElementById('modal-content').innerHTML=html;
      document.getElementById('modal').style.display='block';
    }
    function closeModal(){document.getElementById('modal').style.display='none';}
    function saveModal(id,placeIdx){
      let name=document.getElementById('modal-name').value.trim();
      let date=document.getElementById('modal-date').value;
      let place=document.getElementById('modal-place').value.split(',').map(s=>s.trim()).filter(s=>s);
      let off=document.getElementById('modal-off').checked;
      let memo=document.getElementById('modal-memo').value.trim();
      if(!name||!date||(place.length===0&&!off)){
        alert("ì´ë¦„, ë‚ ì§œ, ê·¼ë¬´ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”");return;
      }
      if(id==null){
        let nid=Date.now()+Math.floor(Math.random()*1000);
        data.push({id:nid,name,date,places:off?["íœ´ë¬´"]:place,memo,off});
      }else{
        let found=data.find(d=>d.id===id);
        if(found){
          // ì—¬ëŸ¬ ê·¼ë¬´ì§€ ì¤‘ í•˜ë‚˜ë§Œ ìˆ˜ì •
          if(typeof placeIdx==="number"){
            found.places[placeIdx]=off?"íœ´ë¬´":place[0];
            found.off=off;
            found.memo=memo;
          }else{
            found.name=name; found.date=date; found.places=off?["íœ´ë¬´"]:place; found.off=off; found.memo=memo;
          }
        }
      }
      saveData();
      closeModal();
      render();
    }
    function delEntry(id,placeIdx){
      if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      let found=data.find(d=>d.id===id);
      if(found){
        if(typeof placeIdx==="number" && found.places.length>1){
          found.places.splice(placeIdx,1);
        }else{
          data=data.filter(d=>d.id!==id);
        }
        saveData();
        render();
      }
    }
    function saveData(){
      localStorage.setItem('scheduleData',JSON.stringify(data));
    }
    // ---------- ì•± ì‹œì‘ ----------
    setView('week');
    </script>
</body>
</html>
