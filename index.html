<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=no">
  <title>밀크티-스케쥴 관리</title>
  <meta name="theme-color" content="#f0f8ff">
  <style>
    :root {
      --main-bg: #f0f8ff;
      --primary: #2196f3;
      --card-radius: 12px;
      --card-border: #b6e0ff;
      --box-shadow: 0 2px 7px rgba(0,0,0,0.07);
      --font: Arial, 'Pretendard', 'Noto Sans KR', sans-serif;
      --holiday: #ffecec;
      --gray: #e0e0e0;
      --color-김민지: #b3e5fc; --color-우인옥: #fff9c4; --color-함주현: #ffe0b2;
      --color-김민정: #d1c4e9; --color-최형심: #c8e6c9; --color-조인자: #ffccbc;
      --color-유지수: #f8bbd0; --color-윤진숙: #ffd180; --color-원경희: #b2dfdb;
      --color-김미경: #f0f4c3; --color-김선애: #f5e1fc; --color-어현미: #ffecb3; --color-안세진: #e6ee9c;
      --default: #e3f2fd;
    }
    body {
      background:var(--main-bg); font-family:var(--font); margin:0; color:#222;
      padding-bottom:68px;
    }
    header {
      background:var(--primary); color:#fff; padding:1.2em 0.8em 0.8em 0.8em;
      border-radius:0 0 1.3em 1.3em; box-shadow:0 2px 12px #90caf9aa;
      text-align:center;
    }
    .header-title { font-size:1.22em; font-weight:700; letter-spacing:0.04em; }
    .tabbar {
      display:flex; gap:0.35em; justify-content:center; margin:1em 0 0.5em 0;
    }
    .tabbar button {
      background:var(--main-bg); color:var(--primary); border:none;
      border-radius:0.7em; font-size:1.01em; font-weight:600; cursor:pointer;
      padding:0.44em 1.1em; margin-right:0.1em; transition:.1s;
    }
    .tabbar .active { background:var(--primary); color:#fff; }
    .weekdaybar { display:flex; gap:0.3em; justify-content:center; margin:0.3em 0 0.7em 0;}
    .weekdaybar button {
      background:var(--main-bg); color:var(--primary); border:none; border-radius:0.5em;
      font-size:1em; font-weight:500; cursor:pointer; padding:0.32em 0.85em;
    }
    .weekdaybar .active { background:var(--primary); color:#fff; }
    .searchbar {
      display:flex; gap:0.6em; margin:0.7em 0 0.7em 0; justify-content:center;
      align-items: center;
    }
    .searchbar input[type="text"] {
      border-radius:0.7em; border:1.5px solid #bbdefb; font-size:1em;
      padding:0.44em 1.1em; width:180px; background:#fff;
    }
    .schedule-list {
      display:grid; grid-template-columns:1fr; gap:1em; max-width:700px; margin:0 auto;
    }
    @media(min-width:660px) {
      .schedule-list { grid-template-columns:1fr 1fr; }
    }
    .card {
      border-radius:var(--card-radius);
      border: 2px solid var(--card-border);
      box-shadow:var(--box-shadow);
      padding:16px 14px 12px 14px;
      display:flex; flex-direction:column; gap:0.19em; min-width:0; position:relative;
      background: var(--default);
      margin-bottom:2px;
      transition:.14s;
    }
    .card.holiday { background:var(--holiday);}
    .card.completed { opacity: 0.6; background:var(--gray);}
    .card .colorbar {
      position:absolute; left:0; top:0; bottom:0; width:0.7em; border-radius:var(--card-radius) 0 0 var(--card-radius);
    }
    .card h3 { font-size:1.12em; font-weight:700; margin:0 0 0.15em 0;}
    .card .date {font-size:0.99em; color:#1e88e5; font-weight:500;}
    .card .place {font-size:1em; color:#3949ab; font-weight:600; margin-bottom:0.07em;}
    .card .tags { margin:0.03em 0 0.25em 0; }
    .type-tag {display:inline-block;padding:0.08em 0.6em; border-radius:0.6em; font-size:0.91em; margin-right:0.2em; background:#bbdefb; color:#1565c0;}
    .off-tag { background:#ffe082; color:#f57c00; }
    .card .memo {margin:0.17em 0 0.07em 0; font-size:0.93em; color:#607d8b; background:#f0f4c3; border-radius:0.5em; padding:0.09em 0.7em;}
    .card .holiday-label { color:#e57373; font-size:0.99em; margin-left:0.54em; font-weight:600;}
    .card input[type="number"] { width:4em; border-radius:0.6em; border:1px solid #bbdefb; background:#fff; padding:0.21em 0.4em;}
    .card label { font-size:0.95em; color:#555; margin-right:0.6em;}
    .card textarea {
      border-radius:0.6em; border:1px solid #bbdefb; font-size:1em;
      padding:0.23em 0.7em; width:96%; min-height:1.8em; resize:vertical;
      margin-top:0.18em; background:#fff;
    }
    .fixed-footer {
      position:fixed; left:0; bottom:0; width:100vw; background:#fff;
      box-shadow:0 -2px 14px #90caf955;
      display:flex; justify-content:space-around; align-items:center;
      z-index:1001; height:58px; border-radius:1.2em 1.2em 0 0;
    }
    .fixed-footer button {
      background:var(--primary); color:#fff; border:none;
      border-radius:0.8em; font-size:1.03em; font-weight:600;
      padding:0.54em 1.3em; cursor:pointer; margin:0 0.3em;
      box-shadow:0 2px 8px #bbdefb77; transition:.1s;
      display:flex; align-items:center; gap:0.3em;
    }
    .summary-view { max-width:700px; margin:1.7em auto 0 auto; }
    .summary-card {
      box-shadow:0 2px 12px #e3f2fd77; border-radius:var(--card-radius);
      background:var(--main-bg); padding:1em 1.1em; margin-bottom:1em;
    }
    .summary-card .name { font-weight:700; color:#1976d2; font-size:1.1em;}
    .summary-row { margin:0.38em 0; }
    .summary-row .place { font-weight:500; color:#3949ab;}
    .summary-row .count { color:#1976d2; font-weight:700; margin-left:0.17em;}
    .month-off-summary { text-align:center; color:#c62828; margin:1em 0 0.2em 0; font-size:1em; font-weight:600;}
    .mypage-btn { margin-left:0.4em; margin-top:0.1em;}
    @media (max-width:540px) {
      .schedule-list { padding:0 0.1em;}
      .summary-view { padding:0 0.1em;}
      .searchbar input[type="text"] { width:98px;}
      .fixed-footer button { font-size:0.95em; padding:0.53em 0.3em;}
    }
  </style>
</head>
<body>
  <header>
    <div class="header-title">밀크티-스케쥴 관리</div>
    <div class="tabbar" id="dateFilter">
      <button onclick="setRange('week')" id="tab-week">주간</button>
      <button onclick="setRange('month')" id="tab-month">월간</button>
      <button class="mypage-btn" onclick="toggleMyPage()" id="mypageBtn">마이페이지</button>
    </div>
    <div class="weekdaybar" id="weekdayFilter"></div>
  </header>
  <div class="searchbar">
    <input type="text" id="search" placeholder="이름 또는 근무지 검색" oninput="renderCards()">
    <button onclick="showSummary()" style="background:#b3e5fc;color:#1976d2;border-radius:0.6em;font-size:1em;padding:0.37em 1.1em;border:none;">요약 보기</button>
  </div>
  <div class="month-off-summary" id="monthOffSummary"></div>
  <div class="schedule-list" id="scheduleList"></div>
  <div class="summary-view" id="summaryView" style="display:none;"></div>
  <div class="fixed-footer">
    <button onclick="savePDF()"><span>PDF 저장</span></button>
    <button onclick="focusSearch()"><span>검색</span></button>
    <button onclick="showSummary()"><span>요약 보기</span></button>
  </div>
  <script>
    // 팀원별 색상
    const memberColors = {
      "김민지": "var(--color-김민지)", "우인옥": "var(--color-우인옥)", "함주현":"var(--color-함주현)",
      "김민정":"var(--color-김민정)", "최형심":"var(--color-최형심)", "조인자":"var(--color-조인자)",
      "유지수":"var(--color-유지수)", "윤진숙":"var(--color-윤진숙)", "원경희":"var(--color-원경희)",
      "김미경":"var(--color-김미경)", "김선애":"var(--color-김선애)", "어현미":"var(--color-어현미)", "안세진":"var(--color-안세진)"
    };
    let schedule = [];
    const holidays2025 = {
      "2025-01-01":"신정", "2025-02-27":"설연휴", "2025-02-28":"설날", "2025-03-01":"삼일절",
      "2025-03-29":"부처님오신날", "2025-05-01":"근로자의날", "2025-05-05":"어린이날", "2025-05-06":"대체공휴일",
      "2025-06-06":"현충일", "2025-08-15":"광복절", "2025-09-06":"추석연휴", "2025-09-07":"추석",
      "2025-09-08":"추석연휴", "2025-10-03":"개천절", "2025-10-09":"한글날", "2025-12-25":"성탄절"
    };
    let rangeType = localStorage.getItem('rangeType') || 'month'; // 'week' or 'month'
    let filterWeekday = ""; // 0~6 or ""
    let mypage = false;
    let myName = localStorage.getItem('myName') || "";
    // 데이터 로딩: localStorage>schedule.json>샘플
    function loadData() {
      if(localStorage.getItem('schedule')) {
        schedule = JSON.parse(localStorage.getItem('schedule'));
        renderCards();
        return;
      }
      fetch('schedule.json')
        .then(r=>r.ok?r.json():[])
        .then(json=>{
          schedule = json.map((row,i)=>({...row, id:row.id||Date.now()+i}));
          saveData();
          renderCards();
        })
        .catch(()=>{
          // 샘플
          schedule = [
            { name:"김민지", date:"2025-05-01", place:"인천영풍", type:"서점", memo:"", dbCount:0, attended:false },
            { name:"우인옥", date:"2025-05-01", place:"송도교보", type:"서점", memo:"유치원 병행", dbCount:3, attended:true }
          ]; saveData(); renderCards();
        });
    }
    function saveData() {
      localStorage.setItem('schedule', JSON.stringify(schedule));
    }
    function getWeekdayStr(d) { return ["일","월","화","수","목","금","토"][d]; }
    function setRange(type) {
      rangeType = type;
      localStorage.setItem('rangeType', type);
      document.getElementById('tab-week').classList.toggle('active',type==='week');
      document.getElementById('tab-month').classList.toggle('active',type==='month');
      renderCards();
    }
    function setWeekdayFilter(idx) {
      filterWeekday = filterWeekday===idx?"":idx;
      renderWeekdayTabs();
      renderCards();
    }
    function renderWeekdayTabs() {
      let wdHtml = "";
      for(let i=0;i<7;i++) {
        wdHtml += `<button class="${filterWeekday==i?'active':''}" onclick="setWeekdayFilter(${i})">${getWeekdayStr(i)}</button>`;
      }
      document.getElementById('weekdayFilter').innerHTML = wdHtml;
    }
    function toggleMyPage() {
      if(!myName) {
        myName = prompt("마이페이지: 내 이름을 입력하세요 (예: 김민지)");
        if(!myName) return;
        localStorage.setItem('myName', myName);
      }
      mypage = !mypage;
      document.getElementById('mypageBtn').classList.toggle('active',mypage);
      renderCards();
    }
    function getFilteredSchedule() {
      let arr = schedule.slice();
      // 범위 필터
      let from="", to="";
      if(rangeType==='week') {
        const today = new Date(), day = today.getDay()||7;
        const monday = new Date(today); monday.setDate(today.getDate()-day+1);
        const sunday = new Date(monday); sunday.setDate(monday.getDate()+6);
        from = monday.toISOString().slice(0,10); to = sunday.toISOString().slice(0,10);
      } else {
        const today = new Date();
        const first = new Date(today.getFullYear(),today.getMonth(),1);
        const last = new Date(today.getFullYear(),today.getMonth()+1,0);
        from = first.toISOString().slice(0,10); to = last.toISOString().slice(0,10);
      }
      arr = arr.filter(row=>row.date>=from && row.date<=to);
      if(filterWeekday!=="") arr = arr.filter(row=>(new Date(row.date).getDay()==filterWeekday));
      if(mypage && myName) arr = arr.filter(row=>row.name==myName);
      let q = document.getElementById('search').value.trim();
      if(q) arr = arr.filter(row=>
        (row.name&&row.name.includes(q)) || (row.place&&row.place.includes(q))
      );
      arr.sort((a,b)=>a.date.localeCompare(b.date)||a.name.localeCompare(b.name));
      return arr;
    }
    function renderCards() {
      document.getElementById('summaryView').style.display="none";
      let arr = getFilteredSchedule();
      let box = document.getElementById('scheduleList');
      box.innerHTML = "";
      let lastDate = "";
      renderMonthOffSummary(arr);
      arr.forEach(row=>{
        const d = new Date(row.date);
        const weekday = getWeekdayStr(d.getDay());
        if(row.date!==lastDate) {
          let holiday=holidays2025[row.date];
          box.innerHTML += `<div style="font-weight:700;font-size:1.03em;margin:1.3em 0 0.1em 0;color:${holiday?'#e53935':'#2196f3'}">
            ${row.date} (${weekday})${holiday?`<span class="holiday-label">[${holiday}]</span>`:""}
          </div>`;
          lastDate=row.date;
        }
        let card = document.createElement('div');
        card.className = 'card'+(holidays2025[row.date]?' holiday':'')+(row.attended?'':' completed');
        let color = memberColors[row.name]||'var(--default)';
        card.innerHTML = `
          <div class="colorbar" style="background:${color}"></div>
          <h3>${row.name||''}</h3>
          <p class="date">${row.date||''}</p>
          <div class="tags">
            <span class="type-tag">${row.type||''}</span>
            ${row.place&&row.place.includes('휴무')?'<span class="type-tag off-tag">휴무</span>':''}
          </div>
          <p class="place">${row.place||''}</p>
          <label><input type="checkbox" ${row.attended?'checked':''} onchange="toggleAttendance('${row.name}','${row.date}')"> 출근 여부</label>
          <label>DB 수 <input type="number" min="0" value="${row.dbCount||''}" placeholder="DB 수 입력" onchange="changeDB('${row.name}','${row.date}',this.value)"></label>
          <textarea placeholder="메모 입력" oninput="changeMemo('${row.name}','${row.date}',this.value)">${row.memo||''}</textarea>
        `;
        box.appendChild(card);
      });
    }
    function toggleAttendance(name,date) {
      let idx = schedule.findIndex(row=>row.name==name&&row.date==date);
      if(idx<0) return;
      schedule[idx].attended = !schedule[idx].attended;
      schedule[idx].lastModified = new Date().toLocaleString();
      saveData(); renderCards();
    }
    function changeDB(name,date,val) {
      let idx = schedule.findIndex(row=>row.name==name&&row.date==date);
      if(idx<0) return;
      schedule[idx].dbCount = Number(val)||"";
      schedule[idx].lastModified = new Date().toLocaleString();
      saveData();
    }
    function changeMemo(name,date,val) {
      let idx = schedule.findIndex(row=>row.name==name&&row.date==date);
      if(idx<0) return;
      schedule[idx].memo = val;
      schedule[idx].lastModified = new Date().toLocaleString();
      saveData();
    }
    function showSummary() {
      let arr = getFilteredSchedule();
      let sumByPlace = {};
      arr.forEach(row=>{
        if(!row.place||row.place==='휴무') return;
        let key = row.place;
        if(!sumByPlace[key]) sumByPlace[key]=0;
        sumByPlace[key]++;
      });
      let box = document.getElementById('summaryView');
      box.innerHTML = `<div style="font-size:1.13em; font-weight:700; margin-bottom:1em; color:#2196f3;">기관별 누적 방문 횟수</div>`;
      Object.entries(sumByPlace).sort((a,b)=>b[1]-a[1]).forEach(([place,cnt])=>{
        box.innerHTML += `<div class="summary-card"><span class="place">${place}</span> <span class="count">${cnt}회</span></div>`;
      });
      box.style.display="block";
      window.scrollTo({top:0,behavior:"smooth"});
    }
    function renderMonthOffSummary(arr) {
      let month = (new Date()).toISOString().slice(0,7);
      let offCnt = arr.filter(row=>(row.place&&row.place.includes('휴무')) && row.date.startsWith(month)).length;
      document.getElementById('monthOffSummary').innerText = `이번달 휴무: ${offCnt}일`;
    }
    function savePDF() { window.print(); }
    function focusSearch() { document.getElementById('search').focus(); }
    // 앱 시작
    renderWeekdayTabs(); loadData();
  </script>
</body>
</html>
