<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=no">
  <title>ë°€í¬í‹°-ìŠ¤ì¼€ì¥´ ê´€ë¦¬</title>
  <meta name="theme-color" content="#f0f8ff">
  <style>
    :root {
      --main-bg: #f0f8ff;
      --primary: #2196f3;
      --card-radius: 12px;
      --card-border: #b6e0ff;
      --box-shadow: 0 2px 7px rgba(0,0,0,0.07);
      --font: Arial, 'Pretendard', 'Noto Sans KR', sans-serif;
      --holiday: #ffecec;
      --gray: #e0e0e0;
      --color-ê¹€ë¯¼ì§€: #b3e5fc; --color-ìš°ì¸ì˜¥: #fff9c4; --color-í•¨ì£¼í˜„: #ffe0b2;
      --color-ê¹€ë¯¼ì •: #d1c4e9; --color-ìµœí˜•ì‹¬: #c8e6c9; --color-ì¡°ì¸ì: #ffccbc;
      --color-ìœ ì§€ìˆ˜: #f8bbd0; --color-ìœ¤ì§„ìˆ™: #ffd180; --color-ì›ê²½í¬: #b2dfdb;
      --color-ê¹€ë¯¸ê²½: #f0f4c3; --color-ê¹€ì„ ì• : #f5e1fc; --color-ì–´í˜„ë¯¸: #ffecb3; --color-ì•ˆì„¸ì§„: #e6ee9c;
      --default: #e3f2fd;
    }
    body { background:var(--main-bg); font-family:var(--font); margin:0; color:#222; padding-bottom:72px;}
    header { background:var(--primary); color:#fff; padding:1.2em 0.8em 0.8em 0.8em; border-radius:0 0 1.3em 1.3em; box-shadow:0 2px 12px #90caf9aa; text-align:center;}
    .header-title { font-size:1.22em; font-weight:700; letter-spacing:0.04em; }
    .tabbar { display:flex; gap:0.35em; justify-content:center; margin:1em 0 0.5em 0;}
    .tabbar button { background:var(--main-bg); color:var(--primary); border:none; border-radius:0.7em; font-size:1.01em; font-weight:600; cursor:pointer; padding:0.44em 1.1em; margin-right:0.1em; transition:.1s;}
    .tabbar .active { background:var(--primary); color:#fff; }
    .weekdaybar { display:flex; gap:0.3em; justify-content:center; margin:0.3em 0 0.7em 0;}
    .weekdaybar button { background:var(--main-bg); color:var(--primary); border:none; border-radius:0.5em; font-size:1em; font-weight:500; cursor:pointer; padding:0.32em 0.85em;}
    .weekdaybar .active { background:var(--primary); color:#fff; }
    .searchbar { display:flex; gap:0.6em; margin:0.7em 0 0.7em 0; justify-content:center; align-items: center;}
    .searchbar input[type="text"] { border-radius:0.7em; border:1.5px solid #bbdefb; font-size:1em; padding:0.44em 1.1em; width:180px; background:#fff;}
    .schedule-list { display:grid; grid-template-columns:1fr; gap:1em; max-width:700px; margin:0 auto;}
    @media(min-width:660px) {.schedule-list { grid-template-columns:1fr 1fr; }}
    .card { border-radius:var(--card-radius); border:2px solid var(--card-border); box-shadow:var(--box-shadow); padding:16px 14px 12px 14px; display:flex; flex-direction:column; gap:0.19em; min-width:0; position:relative; background:var(--default); margin-bottom:2px; transition:.14s;}
    .card.holiday { background:var(--holiday);}
    .card.completed { opacity: 0.6; background:var(--gray);}
    .card .colorbar { position:absolute; left:0; top:0; bottom:0; width:0.7em; border-radius:var(--card-radius) 0 0 var(--card-radius);}
    .card h3 { font-size:1.12em; font-weight:700; margin:0 0 0.15em 0;}
    .card .date {font-size:0.99em; color:#1e88e5; font-weight:500;}
    .card .place {font-size:1em; color:#3949ab; font-weight:600; margin-bottom:0.07em;}
    .card .tags { margin:0.03em 0 0.25em 0; }
    .type-tag {display:inline-block;padding:0.08em 0.6em; border-radius:0.6em; font-size:0.91em; margin-right:0.2em; background:#bbdefb; color:#1565c0;}
    .off-tag { background:#ffe082; color:#f57c00;}
    .card .memo {margin:0.17em 0 0.07em 0; font-size:0.93em; color:#607d8b; background:#f0f4c3; border-radius:0.5em; padding:0.09em 0.7em;}
    .card .holiday-label { color:#e57373; font-size:0.99em; margin-left:0.54em; font-weight:600;}
    .card input[type="number"] { width:4em; border-radius:0.6em; border:1px solid #bbdefb; background:#fff; padding:0.21em 0.4em;}
    .card label { font-size:0.95em; color:#555; margin-right:0.6em;}
    .card textarea { border-radius:0.6em; border:1px solid #bbdefb; font-size:1em; padding:0.23em 0.7em; width:96%; min-height:1.8em; resize:vertical; margin-top:0.18em; background:#fff;}
    .card .edit-btn { position:absolute; top:8px; right:10px; background:none; border:none; color:#1976d2; font-size:1.2em; cursor:pointer;}
    .card .del-btn { position:absolute; top:8px; right:40px; background:none; border:none; color:#e53935; font-size:1.2em; cursor:pointer;}
    .fixed-footer { position:fixed; left:0; bottom:0; width:100vw; background:#fff; box-shadow:0 -2px 14px #90caf955; display:flex; justify-content:space-around; align-items:center; z-index:1001; height:58px; border-radius:1.2em 1.2em 0 0;}
    .fixed-footer button { background:var(--primary); color:#fff; border:none; border-radius:0.8em; font-size:1.03em; font-weight:600; padding:0.54em 1.3em; cursor:pointer; margin:0 0.3em; box-shadow:0 2px 8px #bbdefb77; transition:.1s; display:flex; align-items:center; gap:0.3em;}
    .summary-view { max-width:700px; margin:1.7em auto 0 auto; }
    .summary-card { box-shadow:0 2px 12px #e3f2fd77; border-radius:var(--card-radius); background:var(--main-bg); padding:1em 1.1em; margin-bottom:1em;}
    .summary-card .name { font-weight:700; color:#1976d2; font-size:1.1em;}
    .summary-row { margin:0.38em 0; }
    .summary-row .place { font-weight:500; color:#3949ab;}
    .summary-row .count { color:#1976d2; font-weight:700; margin-left:0.17em;}
    .month-off-summary { text-align:center; color:#c62828; margin:1em 0 0.2em 0; font-size:1em; font-weight:600;}
    .mypage-btn { margin-left:0.4em; margin-top:0.1em;}
    .modal-bg { position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0007;z-index:2000;display:none;justify-content:center;align-items:center;}
    .modal { background:#fff; border-radius:1.2em; padding:1.3em 1em; max-width:340px; width:92vw; }
    .modal h2 { font-size:1.15em; margin-bottom:1em;}
    .modal label { display:block; margin:0.4em 0 0.1em 0;}
    .modal input, .modal select, .modal textarea { width:98%; padding:0.4em 0.6em; margin-bottom:0.5em; border-radius:0.6em; border:1px solid #bbdefb; font-size:1em;}
    .modal textarea { min-height:2em;}
    .modal .btnbar { text-align:right; margin-top:1.1em;}
    .modal .btnbar button {background:var(--primary);color:#fff;border:none;padding:0.48em 1.3em;border-radius:0.7em;font-size:1em;margin-left:0.6em;}
    .modal .btnbar .cancel {background:#b0bec5;}
    .login-admin {margin-bottom:1em;}
    @media (max-width:540px) { .schedule-list { padding:0 0.1em;} .summary-view { padding:0 0.1em;} .searchbar input[type="text"] { width:98px;} .fixed-footer button { font-size:0.95em; padding:0.53em 0.3em;}}
  </style>
</head>
<body>
  <header>
    <div class="header-title">ë°€í¬í‹°-ìŠ¤ì¼€ì¥´ ê´€ë¦¬</div>
    <div class="tabbar" id="dateFilter">
      <button onclick="setRange('week')" id="tab-week">ì£¼ê°„</button>
      <button onclick="setRange('month')" id="tab-month">ì›”ê°„</button>
      <button class="mypage-btn" onclick="toggleMyPage()" id="mypageBtn">ë§ˆì´í˜ì´ì§€</button>
      <button class="mypage-btn" onclick="adminLogin()" id="adminBtn"></button>
      <button class="mypage-btn" onclick="showAddModal()" id="addBtn" style="display:none;">+ ì¼ì •ì¶”ê°€</button>
    </div>
    <div class="weekdaybar" id="weekdayFilter"></div>
  </header>
  <div class="searchbar">
    <input type="text" id="search" placeholder="ì´ë¦„ ë˜ëŠ” ê·¼ë¬´ì§€ ê²€ìƒ‰" oninput="renderCards()">
    <button onclick="showSummary()" style="background:#b3e5fc;color:#1976d2;border-radius:0.6em;font-size:1em;padding:0.37em 1.1em;border:none;">ìš”ì•½ ë³´ê¸°</button>
  </div>
  <div class="month-off-summary" id="monthOffSummary"></div>
  <div class="schedule-list" id="scheduleList"></div>
  <div class="summary-view" id="summaryView" style="display:none;"></div>

  <!-- ì¼ì • ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
  <div class="modal-bg" id="modalBg">
    <div class="modal" id="modalContent"></div>
  </div>
  <div class="fixed-footer">
    <button onclick="savePDF()"><span>PDF ì €ì¥</span></button>
    <button onclick="focusSearch()"><span>ê²€ìƒ‰</span></button>
    <button onclick="showSummary()"><span>ìš”ì•½ ë³´ê¸°</span></button>
  </div>
  <script>
    // ê´€ë¦¬ì ê³„ì •: êµ­ì¥1ëª…, íŒ€ì¥2ëª… (ì˜ˆì‹œ/ì‹¤ì œ ì•”í˜¸ëŠ” ë³€ê²½)
    const ADMINS = [
      {role:'êµ­ì¥', name:'êµ­ì¥ë‹˜', pw:'milkhead'},
      {role:'íŒ€ì¥', name:'ê¹€íŒ€ì¥', pw:'milkteam1'},
      {role:'íŒ€ì¥', name:'ë°•íŒ€ì¥', pw:'milkteam2'}
    ];
    let isAdmin = false, adminName = "";
    const memberColors = { "ê¹€ë¯¼ì§€": "var(--color-ê¹€ë¯¼ì§€)", "ìš°ì¸ì˜¥": "var(--color-ìš°ì¸ì˜¥)", "í•¨ì£¼í˜„":"var(--color-í•¨ì£¼í˜„)", "ê¹€ë¯¼ì •":"var(--color-ê¹€ë¯¼ì •)", "ìµœí˜•ì‹¬":"var(--color-ìµœí˜•ì‹¬)", "ì¡°ì¸ì":"var(--color-ì¡°ì¸ì)", "ìœ ì§€ìˆ˜":"var(--color-ìœ ì§€ìˆ˜)", "ìœ¤ì§„ìˆ™":"var(--color-ìœ¤ì§„ìˆ™)", "ì›ê²½í¬":"var(--color-ì›ê²½í¬)", "ê¹€ë¯¸ê²½":"var(--color-ê¹€ë¯¸ê²½)", "ê¹€ì„ ì• ":"var(--color-ê¹€ì„ ì• )", "ì–´í˜„ë¯¸":"var(--color-ì–´í˜„ë¯¸)", "ì•ˆì„¸ì§„":"var(--color-ì•ˆì„¸ì§„)" };
    let schedule = [
      { name:"ê¹€ë¯¼ì§€", date:"2025-05-01", place:"ì¸ì²œì˜í’", type:"ì¶œê·¼", memo:"", dbCount:0, attended:false },
      { name:"ìš°ì¸ì˜¥", date:"2025-05-01", place:"ì†¡ë„êµë³´", type:"ì¶œê·¼", memo:"ìœ ì¹˜ì› ë³‘í–‰", dbCount:3, attended:true }
    ];
    const holidays2025 = {
      "2025-01-01":"ì‹ ì •", "2025-02-27":"ì„¤ì—°íœ´", "2025-02-28":"ì„¤ë‚ ", "2025-03-01":"ì‚¼ì¼ì ˆ",
      "2025-03-29":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ", "2025-05-01":"ê·¼ë¡œìì˜ë‚ ", "2025-05-05":"ì–´ë¦°ì´ë‚ ", "2025-05-06":"ëŒ€ì²´ê³µíœ´ì¼",
      "2025-06-06":"í˜„ì¶©ì¼", "2025-08-15":"ê´‘ë³µì ˆ", "2025-09-06":"ì¶”ì„ì—°íœ´", "2025-09-07":"ì¶”ì„",
      "2025-09-08":"ì¶”ì„ì—°íœ´", "2025-10-03":"ê°œì²œì ˆ", "2025-10-09":"í•œê¸€ë‚ ", "2025-12-25":"ì„±íƒ„ì ˆ"
    };
    let rangeType = localStorage.getItem('rangeType') || 'month';
    let filterWeekday = ""; let mypage = false; let myName = localStorage.getItem('myName') || "";

    if(localStorage.getItem('schedule')) { try { schedule = JSON.parse(localStorage.getItem('schedule')); } catch(e){} } else { saveData(); }
    function saveData() { localStorage.setItem('schedule', JSON.stringify(schedule)); }

    function getWeekdayStr(d) { return ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][d]; }
    function setRange(type) {
      rangeType = type; localStorage.setItem('rangeType', type);
      document.getElementById('tab-week').classList.toggle('active',type==='week');
      document.getElementById('tab-month').classList.toggle('active',type==='month');
      renderCards();
    }
    function setWeekdayFilter(idx) {
      filterWeekday = filterWeekday===idx?"":idx;
      renderWeekdayTabs(); renderCards();
    }
    function renderWeekdayTabs() {
      let wdHtml = "";
      for(let i=0;i<7;i++) {
        wdHtml += `<button class="${filterWeekday==i?'active':''}" onclick="setWeekdayFilter(${i})">${getWeekdayStr(i)}</button>`;
      }
      document.getElementById('weekdayFilter').innerHTML = wdHtml;
    }
    function toggleMyPage() {
      if(!myName) {
        myName = prompt("ë§ˆì´í˜ì´ì§€: ë‚´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê¹€ë¯¼ì§€)");
        if(!myName) return; localStorage.setItem('myName', myName);
      }
      mypage = !mypage; document.getElementById('mypageBtn').classList.toggle('active',mypage); renderCards();
    }
    function adminLogin() {
      let sel = '<select id="adminSelect">';
      ADMINS.forEach((a,i)=>{ sel+=`<option value="${i}">${a.role} - ${a.name}</option>`; }); sel+='</select>';
      showModal(`<h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
        <div class="login-admin">
        ${sel}
        <input id="adminPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"></div>
        <div class="btnbar">
          <button onclick="loginAdminOk()">ë¡œê·¸ì¸</button>
          <button class="cancel" onclick="closeModal()">ì·¨ì†Œ</button>
        </div>`
      );
    }
    function loginAdminOk() {
      let idx=document.getElementById('adminSelect').value, pw=document.getElementById('adminPw').value;
      if(ADMINS[idx].pw===pw) {
        isAdmin=true; adminName=ADMINS[idx].name; closeModal(); showToast('ê´€ë¦¬ì ë¡œê·¸ì¸ ì™„ë£Œ'); renderCards();
      } else { showToast('ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜'); }
    }
    function adminLogout() { isAdmin=false; adminName=""; showToast('ë¡œê·¸ì•„ì›ƒ'); renderCards();}
    function renderAdminBtn() {
      let btn=document.getElementById('adminBtn');
      btn.innerText = isAdmin?(adminName+'(ë¡œê·¸ì•„ì›ƒ)'):'ê´€ë¦¬ì';
      btn.onclick = isAdmin?adminLogout:adminLogin;
      document.getElementById('addBtn').style.display = isAdmin?"":"none";
    }
    function getFilteredSchedule() {
      let arr = schedule.slice();
      let from="", to="";
      if(rangeType==='week') {
        const today = new Date(), day = today.getDay()||7;
        const monday = new Date(today); monday.setDate(today.getDate()-day+1);
        const sunday = new Date(monday); sunday.setDate(monday.getDate()+6);
        from = monday.toISOString().slice(0,10); to = sunday.toISOString().slice(0,10);
      } else {
        const today = new Date();
        const first = new Date(today.getFullYear(),today.getMonth(),1);
        const last = new Date(today.getFullYear(),today.getMonth()+1,0);
        from = first.toISOString().slice(0,10); to = last.toISOString().slice(0,10);
      }
      arr = arr.filter(row=>row.date>=from && row.date<=to);
      if(filterWeekday!=="") arr = arr.filter(row=>(new Date(row.date).getDay()==filterWeekday));
      if(mypage && myName) arr = arr.filter(row=>row.name==myName);
      let q = document.getElementById('search').value.trim();
      if(q) arr = arr.filter(row=>(row.name&&row.name.includes(q)) || (row.place&&row.place.includes(q)));
      arr.sort((a,b)=>a.date.localeCompare(b.date)||a.name.localeCompare(b.name));
      return arr;
    }
    function renderCards() {
      renderAdminBtn();
      document.getElementById('summaryView').style.display="none";
      let arr = getFilteredSchedule();
      let box = document.getElementById('scheduleList');
      box.innerHTML = "";
      let lastDate = "";
      renderMonthOffSummary(arr);
      arr.forEach((row,i)=>{
        const d = new Date(row.date);
        const weekday = getWeekdayStr(d.getDay());
        if(row.date!==lastDate) {
          let holiday=holidays2025[row.date];
          box.innerHTML += `<div style="font-weight:700;font-size:1.03em;margin:1.3em 0 0.1em 0;color:${holiday?'#e53935':'#2196f3'}">
            ${row.date} (${weekday})${holiday?`<span class="holiday-label">[${holiday}]</span>`:""}
          </div>`;
          lastDate=row.date;
        }
        let card = document.createElement('div');
        card.className = 'card'+(holidays2025[row.date]?' holiday':'')+(row.attended?'':' completed');
        let color = memberColors[row.name]||'var(--default)';
        card.innerHTML = `
          <div class="colorbar" style="background:${color}"></div>
          <h3>${row.name||''}</h3>
          <p class="date">${row.date||''}</p>
          <div class="tags">
            <span class="type-tag">${row.type||''}</span>
            ${row.place&&row.place.includes('íœ´ë¬´')?'<span class="type-tag off-tag">íœ´ë¬´</span>':''}
          </div>
          <p class="place">${row.place||''}</p>
          <label><input type="checkbox" ${row.attended?'checked':''} onchange="toggleAttendance(${i})" ${isAdmin?'':'disabled'}> ì¶œê·¼ ì—¬ë¶€</label>
          <label>DB ìˆ˜ <input type="number" min="0" value="${row.dbCount||''}" placeholder="DB ìˆ˜ ì…ë ¥" onchange="changeDB(${i},this.value)" ${isAdmin?'':'disabled'}></label>
          <textarea placeholder="ë©”ëª¨ ì…ë ¥" oninput="changeMemo(${i},this.value)" ${isAdmin?'':'readonly'}>${row.memo||''}</textarea>
          ${isAdmin?`<button class="edit-btn" onclick="showEditModal(${i})">âœï¸</button>
          <button class="del-btn" onclick="delSchedule(${i})">ğŸ—‘ï¸</button>`:""}
        `;
        box.appendChild(card);
      });
    }
    function toggleAttendance(idx) {
      schedule[idx].attended = !schedule[idx].attended;
      schedule[idx].lastModified = new Date().toLocaleString();
      saveData(); renderCards();
    }
    function changeDB(idx,val) {
      schedule[idx].dbCount = Number(val)||"";
      schedule[idx].lastModified = new Date().toLocaleString();
      saveData();
    }
    function changeMemo(idx,val) {
      schedule[idx].memo = val;
      schedule[idx].lastModified = new Date().toLocaleString();
      saveData();
    }
    function showAddModal() { showEditModal(); }
    function showEditModal(idx) {
      let mode = (typeof idx==="number"), row = mode?schedule[idx]:{name:"",date:"",place:"",type:"ì¶œê·¼",dbCount:0,attended:false,memo:""};
      let names = Array.from(new Set(schedule.map(r=>r.name))).filter(Boolean);
      let html = `<h2>ì¼ì • ${mode?"ìˆ˜ì •":"ì¶”ê°€"}</h2>
        <label>ì´ë¦„<select id="edit-name">${names.map(n=>`<option${row.name==n?' selected':''}>${n}</option>`).join('')}<option value="">ì§ì ‘ì…ë ¥</option></select>
        <input id="edit-name2" placeholder="ìƒˆ ì´ë¦„ ì…ë ¥" style="display:none"></label>
        <label>ë‚ ì§œ<input type="date" id="edit-date" value="${row.date||''}"></label>
        <label>ê·¼ë¬´ì§€(ì—¬ëŸ¬ ê³³ì€ ,ë¡œ êµ¬ë¶„)<input id="edit-place" value="${row.place||''}" placeholder="ê·¼ë¬´ì§€"></label>
        <label>ê·¼ë¬´ìœ í˜•<select id="edit-type"><option>ì¶œê·¼</option><option>íœ´ë¬´</option><option>ì™¸ê·¼</option></select></label>
        <label>DB ìˆ˜<input type="number" id="edit-db" value="${row.dbCount||''}" placeholder="DB ìˆ˜"></label>
        <label>ì¶œê·¼ì—¬ë¶€ <input type="checkbox" id="edit-attend" ${row.attended?'checked':''}></label>
        <label>ë©”ëª¨<textarea id="edit-memo">${row.memo||''}</textarea></label>
        <div class="btnbar">
          <button onclick="saveEditModal(${mode?idx:"null"})">${mode?"ìˆ˜ì •":"ì¶”ê°€"}</button>
          <button class="cancel" onclick="closeModal()">ì·¨ì†Œ</button>
        </div>
        <script>
        document.getElementById('edit-name').onchange=function(){
          document.getElementById('edit-name2').style.display=this.value===''?'block':'none';
        }
        </script>
      `;
      showModal(html);
      setTimeout(()=>{ // ìƒˆ ì´ë¦„ ì…ë ¥ë€ show/hide
        document.getElementById('edit-name').onchange = function(){
          document.getElementById('edit-name2').style.display = this.value===''?'block':'none';
        };
      },100);
    }
    function saveEditModal(idx) {
      let name=document.getElementById('edit-name').value;
      if(name==="") name=document.getElementById('edit-name2').value.trim();
      let date=document.getElementById('edit-date').value;
      let place=document.getElementById('edit-place').value.trim();
      let type=document.getElementById('edit-type').value;
      let dbCount=Number(document.getElementById('edit-db').value)||0;
      let attended=document.getElementById('edit-attend').checked;
      let memo=document.getElementById('edit-memo').value;
      if(!name||!date) { showToast('ì´ë¦„ê³¼ ë‚ ì§œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤'); return; }
      // ì—¬ëŸ¬ ê·¼ë¬´ì§€ ì²˜ë¦¬: ì½¤ë§ˆë¡œ ì—¬ëŸ¬ ì¤„ ìƒì„±
      let places = place.split(',').map(s=>s.trim()).filter(Boolean);
      if(typeof idx==="number") {
        schedule[idx]={name,date,place:places.join(', '),type,dbCount,attended,memo};
      } else {
        places.forEach(p=>{
          schedule.push({name,date,place:p,type,dbCount,attended,memo});
        });
      }
      saveData(); closeModal(); renderCards();
    }
    function delSchedule(idx) {
      if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { schedule.splice(idx,1); saveData(); renderCards(); }
    }
    function showModal(html) {
      document.getElementById('modalContent').innerHTML=html;
      document.getElementById('modalBg').style.display='flex';
    }
    function closeModal() { document.getElementById('modalBg').style.display='none'; }
    function showToast(msg) {
      let t=document.createElement('div');
      t.style.position="fixed";t.style.bottom="6%";t.style.left="50%";t.style.transform="translateX(-50%)";
      t.style.background="#2196f3cc";t.style.color="#fff";t.style.padding="1em 1.3em";t.style.borderRadius="2.2em";t.style.fontSize="1.07em";t.style.zIndex=3000;
      t.innerText=msg; document.body.appendChild(t);
      setTimeout(()=>{t.remove();},1800);
    }
    function showSummary() {
      let arr = getFilteredSchedule();
      let sumByPlace = {}, sumByName = {}, month = (new Date()).toISOString().slice(0,7);
      arr.forEach(row=>{
        // ê·¼ë¬´ì§€ë³„
        if(row.place&&!row.place.includes('íœ´ë¬´')) sumByPlace[row.place]=(sumByPlace[row.place]||0)+1;
        // ì´ë¦„ë³„
        if(!sumByName[row.name]) sumByName[row.name]={íœ´ë¬´:0,ê·¼ë¬´:0,ì™¸ê·¼:0};
        if(row.type=='íœ´ë¬´'||row.place.includes('íœ´ë¬´')) sumByName[row.name].íœ´ë¬´++; else if(row.type=='ì™¸ê·¼') sumByName[row.name].ì™¸ê·¼++; else sumByName[row.name].ê·¼ë¬´++;
      });
      let box=document.getElementById('summaryView');
      box.innerHTML = `<div style="font-size:1.13em; font-weight:700; margin-bottom:1em; color:#2196f3;">ì „ì²´ ìš”ì•½</div>
      <div class="summary-card"><b>ê·¼ë¬´ì§€ë³„ ëˆ„ì  ë°©ë¬¸</b><br>${Object.entries(sumByPlace).sort((a,b)=>b[1]-a[1]).map(([place,cnt])=>`<span class="place">${place}</span> <span class="count">${cnt}íšŒ</span>`).join('<br>')}</div>
      <div class="summary-card"><b>íŒ€ì›ë³„ ì›”ë³„ íœ´ë¬´/ê·¼ë¬´ í†µê³„</b><br>${Object.entries(sumByName).map(([name,s])=>`<span class="name">${name}</span>: íœ´ë¬´ ${s.íœ´ë¬´} / ì¶œê·¼ ${s.ê·¼ë¬´} / ì™¸ê·¼ ${s.ì™¸ê·¼}`).join('<br>')}</div>
      `;
      box.style.display="block";
      window.scrollTo({top:0,behavior:"smooth"});
    }
    function renderMonthOffSummary(arr) {
      let month = (new Date()).toISOString().slice(0,7);
      let offCnt = arr.filter(row=>(row.place&&row.place.includes('íœ´ë¬´')) && row.date.startsWith(month)).length;
      document.getElementById('monthOffSummary').innerText = `ì´ë²ˆë‹¬ íœ´ë¬´: ${offCnt}ì¼`;
    }
    function savePDF() { window.print(); }
    function focusSearch() { document.getElementById('search').focus(); }
    renderWeekdayTabs(); renderCards();
  </script>
</body>
</html>
